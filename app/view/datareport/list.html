<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?=$data['projectName']?>项目—百度信息流统计</title>
    <style>
        body {
            min-height: 100vh;
            flex-direction: column;
            display: flex;
            align-items: center;
            margin: 0;
            font-family: '微软雅黑', Arial, sans-serif;
        }

        #wrapper {
            width: 90%; /* 调整为90% */
            max-width: 980px; /* 设置最大宽度为800px */
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .actual-fans-input {
            text-align: center;
            font-weight: bold;
        }

        th {
            background-color: #f2f2f2;
        }

        .light-blue-column th {
            background-color: #2380fd;
            color: white;
        }

        tfoot tr td {
            color: red;
            font-weight: bold;
        }

        tfoot tr td:first-child {
            border-top: 2px solid #f00;
        }

        input[type="number"] {
            width: 100%;
            padding: 5px;
            margin: 5px 0;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .submit-btn {
            padding: 8px 15px;
            background-color: #2380fd;
            color: white;
            border: none;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 5px;
        }

        .submit-btn:hover {
            background-color: #45a049;
        }

        .title-row th {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
        }

        .tfoot-btn {
            display: flex;
            justify-content: flex-end;
        }

        .header {
            color: #fff;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left img {
            height: 40px;
        }

        .header-center {
            text-align: center;
            font-weight: bold;
            color: #fff;
        }

        .header-right {
            text-align: right;
            font-size: 14px;
            color: #fff;
        }

        .watermark {
            position: absolute;
            color: black;
            font-size: 20px;
            opacity: 0.1;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>

<div id="wrapper">
    <table id="excelData">
        <thead>
        <tr class="title-row light-blue-column">
            <th colspan="9">
                <div class="header">
                    <div class="header-left">
                        <img src="/static/images/logo.jpg?123" alt="Logo">
                    </div>
                    <div class="header-center">
                        <?=$data['projectName']?>项目—百度信息流统计
                    </div>
                    <div class="header-right">
                    </div>
                </div>
            </th>
        </tr>
        <tr class="light-blue-column">
            <th>日期</th>
            <th>后台消费/币</th>
            <th>后台现金消费</th>
            <th>后台加粉成功量</th>
            <th>后台成本/币</th>
            <th>实际加粉成功量</th>
            <th>添加率</th>
            <th>现金加粉成本</th>
        </tr>
        </thead>
        <tbody>
        <?
        foreach ($data['r'] as $k=>$v){
            $v['cost_weixin_baidu'] = $v['weixinFollowSuccessConversions']==0?0:  intval($v['cost']/$v['weixinFollowSuccessConversions']);
            echo '<tr>';
            echo '<td>'.$k.'</td>';
            echo '<td>'.round($v['cost']).'</td>';
            echo '<td>'.round($v['money_cost']).'</td>';
            echo '<td>'.round($v['weixinFollowSuccessConversions']).'</td>';
            echo '<td>'.($v['cost_weixin_baidu']).'</td>';
            echo '<td><input type="number" class="actual-fans-input" name="'.$v['projectName'].'_1_'.$k.'" value="'.$v['trueWeixinFollowSuccessConversions'].'"></td>';
            echo '<td>'.number_format(($v['add_rate']) * 100,0) . '%</td>';
            echo '<td>'.number_format($v['money_trueWeixinFollowSuccessConversions'],1).'</td>';
            echo '</tr>';
        }
        ?>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
            <td >合计</td>
            <td><?=round($data['cost_sum'])?></td>
            <td><?=round($data['money_cost_sum'])?></td>

            <td><?=round($data['weixinFollowSuccessConversions_sum'])?></td>
            <td><?=round($data['cost_weixin_sum'])?></td>
            <td><?=$data['trueWeixinFollowSuccessConversions']?></td>
            <td></td>
            <td><?=number_format($data['money_sum'],1)?></td>
        </tr>
        </tfoot>
    </table>
    <div class="tfoot-btn">
        <input type="hidden" name="csrf_token" value="<?=$data['csrf_token']?>">
        <button id="submitBtn" class="submit-btn">提交</button>
    </div>
</div>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2/dist/sweetalert2.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        $("#submitBtn").click(function () {
            let postData = {};
            $(".actual-fans-input").each(function () {
                let name = $(this).attr('name');
                let value = $(this).val();
                postData[name] = value;
            });
            let csrfToken = $('input[name="csrf_token"]').val();
            postData['csrf_token'] = csrfToken;
            $.post('/datareport/update/', postData, function (data) {
                if (data.code === 0) {
                    Swal.fire({
                        title: '提交成功',
                        text: '你的数据已成功提交！',
                        icon: 'success',
                        confirmButtonText: '返回首页'
                    }).then((result) => {
                        location.reload();
                        if (result.isConfirmed) {
                            //location.reload();
                        }
                    });
                } else {
                    Swal.fire({
                        title: '提交失败',
                        text: '请联系旭成客服。',
                        icon: 'error',
                        confirmButtonText: '确定'
                    });
                }
            }).fail(function () {
                alert('提交失败，请联系旭成客服。');
            });
        });

        let table = document.getElementById('excelData');
        let watermarkText = '旭成传媒';
        let watermarksCount = 10;

        function createWatermark(text, table) {
            let watermark = document.createElement('div');
            watermark.className = 'watermark';
            watermark.textContent = text;

            // 设置水印样式
            let angle = Math.random() * 360;
            let tableRect = table.getBoundingClientRect();
            let x = Math.random() * (table.clientWidth - 100); // 随机 x 坐标
            let y = Math.random() * (table.clientHeight - 50); // 随机 y 坐标

            watermark.style.position = 'absolute';
            watermark.style.transform = `rotate(${angle}deg)`;
            watermark.style.left = `${x}px`;
            watermark.style.top = `${y}px`;
            watermark.style.pointerEvents = 'none'; // 确保水印不会影响表格交互

            table.appendChild(watermark);
        }

        // 确保table是相对定位
        table.style.position = 'relative';

        // 创建多个水印
        for (let i = 0; i < watermarksCount; i++) {
            createWatermark(watermarkText, table);
        }
    });
</script>

</body>
</html>
